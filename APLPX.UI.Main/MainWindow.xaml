<Controls:MetroWindow x:Class="APLPX.UI.Main.MainWindow"
                      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                      xmlns:Dialog="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
                      xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"                    
                      xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
                      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
                      xmlns:module="http://www.codeplex.com/prism"
                      Width="960"
                      Height="600"
                      ShowIconOnTitleBar="True"
                      ShowTitleBar="True"
                      WindowStartupLocation="CenterScreen"
                      GlowBrush="{DynamicResource AccentColorBrush}"
                      NonActiveGlowBrush="Red"
                      WindowState="Maximized"
                      WindowTitleBrush="#2a2a2a"
                      mc:Ignorable="d"
                      d:DesignHeight="600"
                      d:DesignWidth="800" AllowDrop="True">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Icons.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/FlatSlider.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Ellipse x:Key="AppThemeMenuIcon"
                     Width="16"
                     Height="16"
                     Fill="{Binding ColorBrush,
                                    Mode=OneWay}"
                     Stroke="{Binding BorderColorBrush,
                                      Mode=OneWay}"
                     StrokeThickness="1"
                     x:Shared="False" />
            <Ellipse x:Key="AccentMenuIcon"
                     Width="16"
                     Height="16"
                     Fill="{Binding ColorBrush,
                                    Mode=OneWay}"
                     x:Shared="False" />

            <Style x:Key="AppThemeMenuItemStyle"
                   BasedOn="{StaticResource MetroMenuItem}"
                   TargetType="{x:Type MenuItem}">
                <Setter Property="Command" Value="{Binding ChangeAccentCommand}" />
                <Setter Property="Icon" Value="{StaticResource AppThemeMenuIcon}" />
                <Setter Property="Header" Value="{Binding Name, Mode=OneWay}" />
            </Style>

            <Style x:Key="AccentColorMenuItemStyle"
                   BasedOn="{StaticResource MetroMenuItem}"
                   TargetType="{x:Type MenuItem}">
                <Setter Property="Command" Value="{Binding ChangeAccentCommand}" />
                <Setter Property="Icon" Value="{StaticResource AccentMenuIcon}" />
                <Setter Property="Header" Value="{Binding Name, Mode=OneWay}" />
            </Style>

        </ResourceDictionary>
    </Window.Resources>
    <Controls:MetroWindow.IconTemplate>
        <DataTemplate>
            <Grid Width="{TemplateBinding Width}"
                  Height="{TemplateBinding Height}"
                  Margin="4"
                  Background="Transparent"
                  RenderOptions.BitmapScalingMode="HighQuality"
                  RenderOptions.EdgeMode="Aliased">
                <Image Source="/Resources/APL_logo_new.png" />
            </Grid>
        </DataTemplate>
    </Controls:MetroWindow.IconTemplate>
    <Controls:MetroWindow.LeftWindowCommands>
        <Controls:WindowCommands>
            <StackPanel Margin="5,0,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                <TextBlock FontSize="16" Text="PRICE" />
                <TextBlock FontSize="16"
                           Foreground="LightGreen"
                           Text="X" />
                <TextBlock FontSize="16" Text="PERT" />
            </StackPanel>
        </Controls:WindowCommands>
    </Controls:MetroWindow.LeftWindowCommands>
    <Controls:MetroWindow.RightWindowCommands>
        <Controls:WindowCommands>

            <Button Command="{Binding Path=LaunchWebPageCommand}"
                    CommandParameter="http://www.advancedpricinglogic.com/"
                    ToolTip="PRICEXPERT.com web site">
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="PRICE" />
                        <TextBlock Foreground="LightGreen" Text="X" />
                        <TextBlock Text="PERT" />
                    </StackPanel>
                </Button.Content>
            </Button>
            <Menu Height="26"
                  VerticalAlignment="Center"
                  VerticalContentAlignment="Center"
                  Background="Transparent">
                <MenuItem Background="Transparent"
                          Header="Theme"
                          ItemContainerStyle="{StaticResource AppThemeMenuItemStyle}"
                          ItemsSource="{Binding AppThemes,
                                                Mode=OneWay}"
                          TextBlock.FontFamily="Segoe UI"
                          TextBlock.FontSize="12"
                          ToolTip="PRICEXPERT Theme" />
                <MenuItem Background="Transparent"
                          Header="Accent"
                          ItemContainerStyle="{StaticResource AccentColorMenuItemStyle}"
                          ItemsSource="{Binding AccentColors,
                                                Mode=OneWay}"
                          TextBlock.FontFamily="Segoe UI"
                          TextBlock.FontSize="12"
                          ToolTip="PRICEXPERT Accent Color" />
            </Menu>

            <Button Command="{Binding Path=AboutCommand}"
                    Content="About"
                    ToolTip="About PRICEXPERT" />

            <Button Content="Help" ToolTip="Help documentation for PRICEXPERT" />

            <Button Command="{Binding LogoutCommand}" ToolTip="Logout of PRICEXPERT">
                <Button.Content>
                    <TextBlock>
                        <Run Text="Logout" />
                    </TextBlock>

                </Button.Content>
            </Button>
        </Controls:WindowCommands>
    </Controls:MetroWindow.RightWindowCommands>

    <Grid x:Name="layoutRoot"
          MinWidth="1080"
          MinHeight="530"
          Background="DimGray">

        <Grid.RowDefinitions>
            <RowDefinition x:Name="rowModules" Height="Auto" />
            <RowDefinition x:Name="rowDetailContent" Height="*" />
            <RowDefinition x:Name="rowStatusBar" Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel x:Name="ModuleListPanel"
                    Grid.Row="0"
                    Orientation="Horizontal">
            <ToggleButton Name="butSelect"   Command="{Binding PlaningModuleCmd}" MinHeight="70" MinWidth="200" ToolTip="Selection mode" Margin="10,10,0,10" Width="256">

                <Grid Margin="0,0,0,0" Width="200">
                    <Path  Stretch="Uniform" HorizontalAlignment="Left" Fill="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ToggleButton}}, Path=Foreground}" Data="F1 M 25.3333,23.75L 50.6667,23.75L 50.6667,19L 25.3333,19L 25.3333,23.75 Z M 34.8333,60.1667L 41.1667,60.1667L 41.1667,39.5833L 49.0833,49.0833L 49.0833,39.5833L 38,26.9167L 26.9167,39.5833L 26.9167,49.0833L 34.8333,39.5833L 34.8333,60.1667 Z" Width="38.225" Height="48" VerticalAlignment="Center" Margin="0,10,0,0"/>
                    <TextBlock Text="Data Import" HorizontalAlignment="Right" Width="152" FontSize="26" FontWeight="Bold" FontFamily="Segoe UI" Margin="0,10,10,10"/>
                </Grid>

            </ToggleButton>

            <ToggleButton Command="{Binding AdminModuleCmd}" MinHeight="70" MinWidth="200" ToolTip="Selection mode" Margin="10,10,0,10" Width="314">

                <Grid Margin="0,0,0,0" Width="352">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="27*"/>
                        <RowDefinition Height="31*"/>
                    </Grid.RowDefinitions>
                    <Path  Stretch="Uniform" HorizontalAlignment="Left" Fill="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ToggleButton}}, Path=Foreground}" Data="F1 M 38,19C 47.3888,19 55,21.0147 55,23.5038L 55,25.5C 55,27.9853 47.3888,30 38,30C 28.6112,30 21,27.9853 21,25.5L 21,23.5C 21,21.0147 28.6112,19 38,19 Z M 55,52.5C 55,54.9853 47.3888,57 38,57C 28.6112,57 21,54.9853 21,52.5L 21,46.5C 21,48.9853 28.6112,51 38,51C 47.384,51 54.9921,48.9874 55,46.5039L 55,52.5 Z M 55,43.5C 55,45.9853 47.3888,48 38,48C 28.6112,48 21,45.9853 21,43.5L 21,37.5C 21,39.9853 28.6112,42 38,42C 47.384,42 54.9921,39.9874 55,37.5038L 55,43.5 Z M 55,34.5C 55,36.9853 47.3888,39 38,39C 28.6112,39 21,36.9853 21,34.5L 21,28.5C 21,30.9853 28.6112,33 38,33C 47.384,33 54.9921,30.9874 55,28.5038L 55,34.5 Z" Width="57" Height="48" VerticalAlignment="Center" Margin="10,10,0,0" Grid.RowSpan="2"/>
                    <TextBlock Text="Staging DB Config" HorizontalAlignment="Right" Width="244" FontSize="26" FontWeight="Bold" FontFamily="Segoe UI" Margin="0,10,43,10" Grid.RowSpan="2"/>
                </Grid>

            </ToggleButton>

        </StackPanel>

        <Grid x:Name="gridMainContent"
              Grid.Row="1"
              Margin="5,2">

            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="colFeatureSelector" Width="Auto" />
                <ColumnDefinition x:Name="colSteps" Width="Auto" />
                <ColumnDefinition x:Name="colDetailContent" Width="*" />
                <ColumnDefinition x:Name="colActions" Width="Auto" />
                <ColumnDefinition x:Name="colCommands" Width="Auto" />
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition x:Name="rowContextHeader" Height="Auto" />
                <RowDefinition x:Name="rowDetailView" Height="*" />
            </Grid.RowDefinitions>
            <Grid Grid.Row="1" Grid.Column="0">
                <ToggleButton Command="{Binding ImportMenuCmd}" Visibility="{Binding IsPlanningFeatureListVisibile, Converter={StaticResource BoolToVis}, FallbackValue=Hidden}" VerticalAlignment="Top" ToolTip="Destination Sql server" Height="108" Margin="6,0,4,0">
                    <StackPanel Width="90" HorizontalAlignment="Center" Margin="0,5,0,0" Height="89">
                        <Grid Height="51">
                            <Path Canvas.Left="21" Canvas.Top="19" Stretch="Fill" Fill="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ToggleButton}}, Path=Foreground}" Data="F1 M 20,17L 43.25,17L 56,29.75L 56,59L 20,59L 20,17 Z M 24,21L 24,55L 52,55L 52,34L 39,34L 39,21L 24,21 Z M 43,22.25L 43,30L 50.75,30L 43,22.25 Z M 30,48L 34,48L 34,39.5L 37,42.5L 37,37.75L 32,32.75L 27,38.25L 27,42.5L 30,39.5L 30,48 Z M 38,49L 38,53L 26,53L 26,49L 38,49 Z" Margin="10,0,10,-17"/>
                        </Grid>
                        <TextBlock Text="Import File" FontSize="14"  FontFamily="Segoe UI symbol" Height="24" Margin="10,15,9,0"/>
                    </StackPanel>
                </ToggleButton>
                <ToggleButton Command="{Binding StagingDBFormCmd}" Visibility="{Binding IsAdminFeatureListVisibile, Converter={StaticResource BoolToVis}, FallbackValue=Hidden}" VerticalAlignment="Top" ToolTip="Destination Sql server" Height="103" Margin="6,0,4,0">
                    <StackPanel Width="90" HorizontalAlignment="Center" Margin="0,5,0,0" Height="89">
                        <Grid Height="51">
                            <Path Canvas.Left="5" Canvas.Top="23.5" Stretch="Fill" Fill="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ToggleButton}}, Path=Foreground}" Data="F1 M 38,33C 47.384,33 54.9921,30.9874 55,28.5039L 55,52.5C 55,54.9853 47.3888,57 38,57L 38,49.1579L 38.0675,49.16L 39.23,50.4137C 39.6033,50.8029 39.9871,51.1417 40.3813,51.43C 40.7754,51.7183 41.1875,51.9454 41.6175,52.1113C 42.0475,52.2771 42.5183,52.36 43.03,52.36L 44.1075,52.2913L 44.8,52.155L 44.8,50.085L 44.5425,50.1663L 44.25,50.2288L 43.9487,50.2675L 43.675,50.28L 42.8237,50.215L 42.0613,49.9813L 41.3237,49.5213L 40.55,48.7775C 41.635,48.3892 42.4808,47.72 43.0875,46.77C 43.6958,45.81 44,44.6633 44,43.33C 44,41.6233 43.5025,40.2508 42.5075,39.2125C 41.5175,38.1642 40.2233,37.64 38.625,37.64L 38,37.6653L 38,33 Z M 52,23.5L 55,23.5L 55,25.5C 55,27.9853 47.3888,30 38,30L 38,25C 45.732,25 52,24.3285 52,23.5 Z M 38.5375,39.88C 39.3975,39.88 40.07,40.1992 40.555,40.8375C 41.0383,41.4658 41.28,42.34 41.28,43.46C 41.28,44.54 41.0275,45.3892 40.5225,46.0075C 40.0242,46.6158 39.3417,46.92 38.475,46.92L 38,46.8837L 38,39.9251L 38.5375,39.88 Z M 52.48,49L 52.48,46.92L 48.32,46.92L 48.32,37.8L 45.76,37.8L 45.76,49L 52.48,49 Z " Margin="45,7,10,-9"/>
                            <Path Canvas.Left="21" Canvas.Top="19" Stretch="Fill" Fill="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ToggleButton}}, Path=Foreground}" Data="F1 M 38,57C 28.6111,57 21,54.9853 21,52.5L 21,28.5C 21,30.9853 28.6112,33 38,33L 38,37.6436C 36.5609,37.7589 35.3876,38.296 34.48,39.2549C 33.4533,40.3399 32.94,41.7666 32.94,43.5349C 32.94,44.3083 33.0616,45.0324 33.305,45.7074C 33.5483,46.3824 33.8929,46.9704 34.3387,47.4712C 34.7846,47.972 35.3216,48.3703 35.95,48.6662C 36.5654,48.9559 37.2487,49.1134 38,49.1385L 38,57 Z M 55,23.5L 52,23.5C 52,22.6716 45.732,22 38,22C 30.268,22 24,22.6716 24,23.5C 24,24.3285 30.268,25 38,25L 38,30C 28.6111,30 21,27.9853 21,25.5L 21,23.5C 21,21.0148 28.6112,19 38,19C 47.384,19 54.9921,21.0127 55,23.5 Z M 24.14,48.5324C 24.5483,48.7341 25.0312,48.8858 25.5887,48.9874C 26.1462,49.0891 26.7341,49.1399 27.3525,49.1399C 27.9541,49.1399 28.5258,49.0829 29.0675,48.9687C 29.6091,48.8545 30.0841,48.6666 30.4925,48.4049C 30.9008,48.1433 31.2241,47.8016 31.4625,47.3799C 31.7008,46.9583 31.82,46.4366 31.82,45.8149C 31.82,45.3649 31.7533,44.9704 31.62,44.6312C 31.4866,44.292 31.2941,43.9904 31.0425,43.7262C 30.7908,43.462 30.4891,43.2249 30.1375,43.0149L 28.9475,42.4199L 28.0775,42.0287L 27.4225,41.6399L 27.0062,41.2212C 26.9087,41.0737 26.86,40.9066 26.86,40.7199C 26.86,40.5416 26.9037,40.3804 26.9912,40.2362L 27.3612,39.8649L 27.9475,39.6249L 28.7175,39.5399L 29.37,39.5874L 30.06,39.7349L 30.735,39.9874L 31.34,40.3399L 31.34,38.0424C 30.96,37.8991 30.5445,37.7929 30.0937,37.7237L 28.5425,37.6199C 27.9475,37.6199 27.3841,37.6833 26.8525,37.8099C 26.3208,37.9366 25.8529,38.1349 25.4487,38.4049C 25.0445,38.6749 24.7254,39.0183 24.4912,39.4349C 24.257,39.8516 24.14,40.3499 24.14,40.9299C 24.14,41.6699 24.3516,42.3016 24.775,42.8249C 25.1983,43.3483 25.8416,43.7908 26.705,44.1524L 27.6512,44.5649L 28.41,44.9849L 28.915,45.4587C 29.0383,45.6295 29.1,45.8233 29.1,46.0399L 28.9837,46.5074C 28.9062,46.6508 28.7883,46.7754 28.63,46.8812L 28.0387,47.1299L 27.21,47.2199C 26.6716,47.2199 26.1383,47.1266 25.61,46.9399C 25.0816,46.7533 24.5916,46.4733 24.14,46.0999L 24.14,48.5324 Z M 36.4325,40.8324C 36.8449,40.3182 37.3674,40.0079 38,39.9016L 38,46.8667C 37.3683,46.7709 36.8433,46.4678 36.425,45.9574C 35.915,45.3241 35.66,44.4699 35.66,43.3949C 35.66,42.3299 35.9175,41.4758 36.4325,40.8324 Z " Margin="10,0,10,-9"/>
                        </Grid>
                        <TextBlock Text="Staging DB" FontSize="14"  FontFamily="Segoe UI symbol" Height="27" Margin="10,15,9,0"/>
                    </StackPanel>
                </ToggleButton>
                <ToggleButton  Visibility="{Binding IsAdminFeatureListVisibile, Converter={StaticResource BoolToVis}, FallbackValue=Hidden}" VerticalAlignment="Top" ToolTip="Configure the DB tool" Height="108" Margin="6,108,4,0">
                    <StackPanel Width="90" HorizontalAlignment="Center" Margin="0,5,0,0" Height="89">
                        <Grid Height="51">
                            <Path Canvas.Left="21" Canvas.Top="19" Stretch="Fill" Fill="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ToggleButton}}, Path=Foreground}" Data="F1 M 38,19C 47.3888,19 55,21.0147 55,23.5038L 55,25.5C 55,27.9853 47.3888,30 38,30C 28.6112,30 21,27.9853 21,25.5L 21,23.5C 21,21.0147 28.6112,19 38,19 Z M 55,52.5C 55,54.9853 47.3888,57 38,57C 28.6112,57 21,54.9853 21,52.5L 21,46.5C 21,48.9853 28.6112,51 38,51C 47.384,51 54.9921,48.9874 55,46.5039L 55,52.5 Z M 55,43.5C 55,45.9853 47.3888,48 38,48C 28.6112,48 21,45.9853 21,43.5L 21,37.5C 21,39.9853 28.6112,42 38,42C 47.384,42 54.9921,39.9874 55,37.5038L 55,43.5 Z M 55,34.5C 55,36.9853 47.3888,39 38,39C 28.6112,39 21,36.9853 21,34.5L 21,28.5C 21,30.9853 28.6112,33 38,33C 47.384,33 54.9921,30.9874 55,28.5038L 55,34.5 Z " Margin="10,0,10,-10"/>
                        </Grid>
                        <TextBlock Text="DB Tool" HorizontalAlignment="Center" FontSize="14"  FontFamily="Segoe UI symbol" Height="27" Margin="20,15,10,0" Width="60"/>
                    </StackPanel>
                </ToggleButton>
            </Grid>

            <StackPanel x:Name="ContextHeaderPanel"
                        Grid.Row="0"
                        Grid.Column="1"
                        Grid.ColumnSpan="2"
                        Orientation="Horizontal"
                        Visibility="{Binding Path=IsModuleSelected,
                                             Converter={StaticResource BooleanToVisibilityConverter}}">

                <TextBlock x:Name="txtUser"
                           Margin="5"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Style="{StaticResource BaseStyleTextBlock}"
                           Text="{Binding Path=Session.User.Identity.Name,
                                          StringFormat=User: {0}}" />

                <TextBlock x:Name="txtSelectedModule"
                           Margin="5"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Style="{StaticResource BaseStyleTextBlock}"
                           Text="{Binding Path=SelectedModule.Name,
                                          StringFormat={}Module: {0}}" />

                <TextBlock x:Name="txtSelectedFeature"
                           Margin="15,5"
                           Text="{Binding Path=SelectedFeature.Name,
                                          StringFormat={}Feature: {0}}">
                    <TextBlock.Style>
                        <Style BasedOn="{StaticResource BaseStyleTextBlock}" TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=SelectedFeature}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                            <Setter Property="FontSize" Value="14" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                            <Setter Property="Margin" Value="5" />
                        </Style>

                    </TextBlock.Style>
                </TextBlock>
                <TextBlock x:Name="txtSelectedEntity" Margin="15,5">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="{}{0} Name: {1}">
                            <Binding Path="SelectedFeature.Classification" />
                            <Binding Path="SelectedEntity.Identity.Name" />
                        </MultiBinding>
                    </TextBlock.Text>
                    <TextBlock.Style>
                        <Style BasedOn="{StaticResource BaseStyleTextBlock}" TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=SelectedEntity}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                            <Setter Property="FontSize" Value="14" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                            <Setter Property="Margin" Value="5" />
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StackPanel>



            <ScrollViewer x:Name="DetailContentScrollViewer"
                          Grid.Row="1"
                          Grid.Column="2"
                          Width="Auto"
                          Height="Auto"
                          Background="{StaticResource WindowBackgroundBrush}"
                          ScrollViewer.HorizontalScrollBarVisibility="Auto"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          d:IsEffectDisabled="True">
                <ScrollViewer.Effect>
                    <DropShadowEffect BlurRadius="10" Opacity="0" />
                </ScrollViewer.Effect>
                <Grid>

                    <ItemsControl Name="Admin" Visibility="{Binding IsStagingDBFeatureModuleVisible, Converter={StaticResource BoolToVis}, FallbackValue=Hidden}" module:RegionManager.RegionName="AdminRegion" />
                    <ItemsControl Name="Planning" AllowDrop="True" Visibility="{Binding IsImportMenuFeatureVisible, Converter={StaticResource BoolToVis}, FallbackValue=Hidden}" module:RegionManager.RegionName="PlaningRegion" />

                </Grid>

            </ScrollViewer>


        </Grid>

        <StatusBar Grid.Row="2"
                   Margin="117,5,5,5"
                   Background="Transparent">
            <StatusBarItem>
                <TextBlock Name="lblCursorPosition" Text="{Binding CurrentStatusBarMessage}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
    
</Controls:MetroWindow>
